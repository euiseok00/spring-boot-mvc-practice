# ğŸ—ï¸ Comento Statistic í”„ë¡œì íŠ¸ ì „ì²´ êµ¬ì¡°ì™€ íë¦„

## ğŸ“ í”„ë¡œì íŠ¸ êµ¬ì¡°
```
comentoStatistic/
â”œâ”€â”€ src/main/java/com/demo/comentoStatistic/
â”‚   â”œâ”€â”€ ComentoStatisticApplication.java     # ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ì 
â”‚   â”œâ”€â”€ controller/
â”‚   â”‚   â”œâ”€â”€ HomeController.java              # ğŸ  í™ˆí˜ì´ì§€ ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”‚   â””â”€â”€ StatisticController.java          # ğŸ“Š í†µê³„ API ì»¨íŠ¸ë¡¤ëŸ¬
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â””â”€â”€ StatisticService.java             # ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§
â”‚   â”œâ”€â”€ dao/
â”‚   â”‚   â””â”€â”€ StatisticMapper.java              # ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì¸í„°í˜ì´ìŠ¤
â”‚   â””â”€â”€ dto/
â”‚       â”œâ”€â”€ YearCountDto.java                 # ğŸ“¦ ì—°ë„ë³„ ë°ì´í„° ê°ì²´
â”‚       â””â”€â”€ YearMonthCountDto.java            # ğŸ“¦ ì—°ì›”ë³„ ë°ì´í„° ê°ì²´
â””â”€â”€ src/main/resources/
    â”œâ”€â”€ application.properties                # âš™ï¸ ì„¤ì • íŒŒì¼
    â”œâ”€â”€ mapper/
    â”‚   â””â”€â”€ StatisticMapper.xml               # ğŸ“‹ SQL ì¿¼ë¦¬ íŒŒì¼
    â””â”€â”€ static/
        â””â”€â”€ index.html                        # ğŸŒ í™ˆí˜ì´ì§€ HTML
```

## ğŸ”„ ì „ì²´ ë°ì´í„° íë¦„ (ìƒì„¸ ë¶„ì„)

### 1ï¸âƒ£ í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ â†’ ì»¨íŠ¸ë¡¤ëŸ¬
```
Browser: http://localhost:8031/stats/logins/24
    â†“
Spring Boot: URL ë§¤í•‘ ê²€ìƒ‰
    â†“
StatisticController.getYearLoginCount("24")
```

### 2ï¸âƒ£ ì»¨íŠ¸ë¡¤ëŸ¬ â†’ ì„œë¹„ìŠ¤
```java
// StatisticController.java
@RequestMapping(value="/stats/logins/{year}")
public ResponseEntity<YearCountDto> getYearLoginCount(@PathVariable("year") String year) {
    // 1. URLì—ì„œ "24" ì¶”ì¶œ
    // 2. ì„œë¹„ìŠ¤ í˜¸ì¶œ
    return ResponseEntity.ok(statisticService.getYearLogins(year));
}
    â†“
StatisticService.getYearLogins("24")
```

### 3ï¸âƒ£ ì„œë¹„ìŠ¤ â†’ ë§¤í¼
```java
// StatisticService.java
public YearCountDto getYearLogins(String year) {
    // 1. "24" íŒŒë¼ë¯¸í„° ë°›ìŒ
    // 2. ë§¤í¼ í˜¸ì¶œ (MyBatisê°€ ìë™ìœ¼ë¡œ êµ¬í˜„ì²´ ìƒì„±)
    return statisticMapper.selectYearLogin(year);
}
    â†“
StatisticMapper.selectYearLogin("24")  // ì¸í„°í˜ì´ìŠ¤ë§Œ ì¡´ì¬
```

### 4ï¸âƒ£ ë§¤í¼ â†’ XML (MyBatis ë§ˆë²•)
```java
// MyBatisê°€ ëŸ°íƒ€ì„ì— ìƒì„±í•˜ëŠ” ê°€ìƒì˜ êµ¬í˜„ì²´
public class StatisticMapperImpl implements StatisticMapper {
    @Override
    public YearCountDto selectYearLogin(String year) {
        // XMLì˜ SQLì„ ì°¾ì•„ì„œ ì‹¤í–‰
        SqlSession session = sqlSessionFactory.openSession();
        return session.selectOne("selectYearLogin", year);
    }
}
    â†“
StatisticMapper.xmlì˜ SQL ì‹¤í–‰
```

### 5ï¸âƒ£ XML â†’ ë°ì´í„°ë² ì´ìŠ¤
```xml
<!-- StatisticMapper.xml -->
<select id="selectYearLogin" parameterType="string" resultType="YearCountDto">
    select concat('20', #{year}) as year, count(*) as totCnt
    from statistic.request_info ri
    where ri.create_date IS NOT NULL
      AND left(ri.create_date, 2) = #{year}
</select>
```

**ì‹¤ì œ ì‹¤í–‰ë˜ëŠ” SQL:**
```sql
select concat('20', '24') as year, count(*) as totCnt
from statistic.request_info ri
where ri.create_date IS NOT NULL
  AND left(ri.create_date, 2) = '24'
```

### 6ï¸âƒ£ ë°ì´í„°ë² ì´ìŠ¤ â†’ DTO ë§¤í•‘
```sql
-- DB ê²°ê³¼
+------+--------+
| year | totCnt |
+------+--------+
| 2024 |   150  |
+------+--------+
```

```java
// MyBatis ìë™ ë§¤í•‘
YearCountDto dto = new YearCountDto();
dto.setYear("2024");    // "year" ì»¬ëŸ¼ â†’ setYear()
dto.setTotCnt(150);     // "totCnt" ì»¬ëŸ¼ â†’ setTotCnt()
```

### 7ï¸âƒ£ DTO â†’ ì»¨íŠ¸ë¡¤ëŸ¬ â†’ í´ë¼ì´ì–¸íŠ¸
```java
// ì—­ë°©í–¥ íë¦„
DTO â†’ Service â†’ Controller â†’ JSON â†’ Browser
```

**ìµœì¢… JSON:**
```json
{
  "year": "2024",
  "totCnt": 150
}
```

## ğŸ§© ê° ì»´í¬ë„ŒíŠ¸ ìƒì„¸ ë¶„ì„

### ComentoStatisticApplication.java
```java
@SpringBootApplication  // â­ ìŠ¤í”„ë§ ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜
@MapperScan("com.demo.comentoStatistic.dao")  // ğŸ—ºï¸ ë§¤í¼ ìŠ¤ìº”
public class ComentoStatisticApplication {
    public static void main(String[] args) {
        SpringApplication.run(ComentoStatisticApplication.class, args);
    }
}
```
**ì—­í• **: 
- ìŠ¤í”„ë§ ë¶€íŠ¸ ì‹œì‘
- `dao` íŒ¨í‚¤ì§€ ìŠ¤ìº”í•˜ì—¬ `StatisticMapper`ë¥¼ Beanìœ¼ë¡œ ë“±ë¡

### HomeController.java
```java
@RestController  // ğŸ“¡ JSON ì‘ë‹µ ì»¨íŠ¸ë¡¤ëŸ¬
public class HomeController {
    @GetMapping("/")  // ğŸ  ë£¨íŠ¸ URL ë§¤í•‘
    public String home() {
        return "index.html";  // ğŸ“„ static/index.html íŒŒì¼ ì„œë¹™
    }
}
```

### StatisticController.java
```java
@Controller  // ğŸ¯ MVC ì»¨íŠ¸ë¡¤ëŸ¬
public class StatisticController {
    @Autowired  // ğŸ”Œ ì˜ì¡´ì„± ì£¼ì…
    private StatisticService statisticService;
    
    @RequestMapping(value="/stats/logins/{year}", produces = "application/json")
    @ResponseBody  // ğŸ“¤ JSONìœ¼ë¡œ ì‘ë‹µ
    public ResponseEntity<YearCountDto> getYearLoginCount(@PathVariable("year") String year) {
        // ğŸ”„ ì„œë¹„ìŠ¤ í˜¸ì¶œ í›„ HTTP 200 ì‘ë‹µ
        return ResponseEntity.ok(statisticService.getYearLogins(year));
    }
}
```

### StatisticService.java
```java
@Service  // ğŸ’¼ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ê³„ì¸µ
public class StatisticService {
    @Autowired
    private StatisticMapper statisticMapper;  // ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì ‘ê·¼
    
    public YearCountDto getYearLogins(String year) {
        // ğŸ“Š í†µê³„ ë°ì´í„° ì¡°íšŒ
        return statisticMapper.selectYearLogin(year);
    }
}
```

### StatisticMapper.java
```java
@Mapper  // ğŸ—ºï¸ MyBatis ë§¤í¼ ì¸í„°í˜ì´ìŠ¤
public interface StatisticMapper {
    YearCountDto selectYearLogin(String year);  // ğŸ“‹ ë©”ì„œë“œëª… = XMLì˜ id
    YearMonthCountDto selectYearMonthLogin(String yearMonth);
}
```
**ë§ˆë²•**: MyBatisê°€ ì´ ì¸í„°í˜ì´ìŠ¤ì˜ êµ¬í˜„ì²´ë¥¼ ëŸ°íƒ€ì„ì— ìë™ ìƒì„±!

### DTO í´ë˜ìŠ¤ë“¤
```java
// YearCountDto.java - ğŸ“¦ ë°ì´í„° ìš´ë°˜ìš© ê°ì²´
public class YearCountDto {
    private String year;     // SQLì˜ "as year"ì™€ ë§¤í•‘
    private Integer totCnt;  // SQLì˜ "as totCnt"ì™€ ë§¤í•‘
    
    // getter/setterëŠ” MyBatisê°€ ìë™ í˜¸ì¶œ
}
```

## âš™ï¸ ì„¤ì • íŒŒì¼ ë¶„ì„

### application.properties
```properties
# ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°
spring.datasource.url=jdbc:mariadb://localhost:3306/statistic
spring.datasource.username=root
spring.datasource.password=1234

# ğŸ“‹ MyBatis ì„¤ì •
mybatis.mapper-locations=classpath:mapper/*.xml  # XML íŒŒì¼ ìœ„ì¹˜
mybatis.type-aliases-package=com.demo.comentoStatistic.dto  # DTO íŒ¨í‚¤ì§€

# ğŸŒ ì„œë²„ ì„¤ì •
server.port=8031
server.servlet.contextPath=/

# ğŸ“ ë¡œê¹…
logging.level.org.springframework.jdbc=DEBUG
logging.level.org.mybatis=DEBUG
```

## ğŸ¯ í•µì‹¬ ê¸°ìˆ ë“¤ì˜ ì—°ë™ ë°©ì‹

### Spring Boot + MyBatis ì—°ë™
1. **@MapperScan**ì´ `dao` íŒ¨í‚¤ì§€ ìŠ¤ìº”
2. **@Mapper** ì¸í„°í˜ì´ìŠ¤ ë°œê²¬
3. **MyBatis**ê°€ êµ¬í˜„ì²´ ë™ì  ìƒì„±
4. **Spring**ì´ Beanìœ¼ë¡œ ë“±ë¡
5. **@Autowired**ë¡œ ì£¼ì… ê°€ëŠ¥

### XML + ìë°” ë§¤í•‘
1. **ë©”ì„œë“œëª…** = **XMLì˜ id**
2. **íŒŒë¼ë¯¸í„°** = **SQLì˜ #{parameter}**
3. **ë°˜í™˜íƒ€ì…** = **resultType**
4. **ì»¬ëŸ¼ëª…** = **DTO í•„ë“œëª…**

## ğŸ“Š API ì—”ë“œí¬ì¸íŠ¸ ìš”ì•½

### í™ˆí˜ì´ì§€
- **URL**: `GET http://localhost:8031/`
- **ì‘ë‹µ**: HTML í˜ì´ì§€ (index.html)

### ì—°ë„ë³„ ë¡œê·¸ì¸ í†µê³„
- **URL**: `GET http://localhost:8031/stats/logins/{year}`
- **ì˜ˆì‹œ**: `/stats/logins/24`
- **ì‘ë‹µ**: `{"year": "2024", "totCnt": 150}`

### ì—°ì›”ë³„ ë¡œê·¸ì¸ í†µê³„
- **URL**: `GET http://localhost:8031/stats/logins/{year}/{month}`
- **ì˜ˆì‹œ**: `/stats/logins/24/01`
- **ì‘ë‹µ**: `{"yearMonth": "202401", "totCnt": 50}`

## ğŸ” ê¸°ìˆ  ìŠ¤íƒ ìš”ì•½
- **Backend**: Spring Boot 3.4.2
- **Database**: MariaDB
- **ORM**: MyBatis 3.0.3
- **Build Tool**: Maven
- **Java Version**: 17

ì´ê²ƒì´ Comento Statistic í”„ë¡œì íŠ¸ì˜ ì™„ì „í•œ ì•„í‚¤í…ì²˜ì™€ ë°ì´í„° íë¦„ì…ë‹ˆë‹¤! ğŸ‰